## 闭包
> 关于闭包，无论是在日常开发中还是面试中都是老生常谈的内容，但是想将 “闭包” 概念讲明白还是比较难的，我们这篇文章尝试讲解下什么是闭包

### 0. 变量的作用范围

其实这里我们就不得不提到变量的作用范围了，我们都知道作用域大致分为三种：
- 全局作用域
- 局部作用域
- 块级作用域

> - 全局变量是随着 浏览器文档的销毁 而 销毁
> - 局部变量是随着 方法的执行结束而销毁
> - 块级变量是随着 块级作用域运行结果而销毁


此时我们就拿局部变量来说，一般的局部变量都是会随着方法的执行结束而销毁，从而被V8 的垃圾回收机制 回收。
但是 垃圾回收机制发现 函数内的变量还在被别的地方使用，就会停止对该变量的回收。这样就形成了闭包



### 1. 什么叫闭包
- 能够访问自由变量的函数就是闭包。自由变量：能访问到某个变量，但是这个变量既不是函数内部定义，也不是函数参数
- 变量所在的上下文被销毁，但是依旧能访问到该变量

> 从技术的角度来讲，任何函数都是一种闭包。如下例：
```js
function a() {
  const test = '1'
  function b() {
    console.log(test) // 闭包。可以通过chrome devtools 来断点
  }
}
```

### 2. 闭包意义
> 闭包的意义在于 保护 + 保存。 定义在闭包内的变量是不能够让外部访问的这是保护。同时闭包内的变量使用后也不能被销毁的这是保存

```js
function run() {
  let count = 0
  return function() {
    count ++
  }
}

const counter = run()
counter() // 1
counter() // 2
```
- 上述实例中变量`count`的内存变量一直得不到释放。 会一直保存在闭包中

### 3. 闭包用途
- 封装：使用闭包封装功能。将部分功能返回供外部使用
- 模拟作用域：在es6之前没有出现块级作用域。可以使用闭包模拟作用域

### 4. 问题
- 就是因为闭包有保存的作用，使得内部变量占用内存无法释放，所以过多的使用闭包会造成内存溢出
- 部门功能可以使用let/ const 来替代闭包